# QT-Build

Prepare specific [`QT`](https://github.com/qt/qt5) version to be used by other workflows. The build is using
[GitHub Actions](https://help.github.com/en/actions/automating-your-workflow-with-github-actions), work-flow file: [main.yml](.github/workflows/main.yml).
This workflow runs under the `windows-latest` virtual environment, currently this is [Windows Server 2019](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/software-installed-on-github-hosted-runners#windows-server-2019).

The binaries generated by this workflow will be compatible with the builds made by the same virtual environment. This is an alternative of the official distributions from [Qt Downloads](https://download.qt.io/online/qtsdkrepository), where it is not easy to find the compatible disribution.

Already generated `QT` distributions are in published in [Releases](../../releases).

## Preparation

The workflow needs a personal access token named `REPO_TOKEN` to be added to the repository's secrets.
This is because the automatically created `GITHUB_TOKEN` usually expires before the build completes, see
[Authenticating with the GITHUB_TOKEN](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/authenticating-with-the-github_token).

- Create personal a access token here: https://github.com/settings/tokens. Check the
  `repo` scope (Full control of private repositories), type some meaningful note like *"QT-Build REPO_TOKEN"*
  and copy the generated token.

- Open the repository's [Settings -> Secrets](../../settings/secrets) and click on `Add a new secret`, write `REPO_TOKEN` under `Name` and
  paste the token generated by the above step under `Value`. Click on `Add sectet`.

- Open the repository's [Settings -> Actions](../../settings/actions) and select `Enable local and third party Actions for this repository`.

## Initiating build

The build is triggered by creating a release, or by marking an existing release a `pre-release`, see
[Events that trigger workflows](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/events-that-trigger-workflows).
The tag name of the release must match the tag from [qt/qt5](https://github.com/qt/qt5). The specific tag from the `QT` repository will be
checked out and build by using MSVS tool-chain.

### Initiating a new build

- Create new release [Draft a new Release](../../releases/new)

- Type the tag of the `QT` version to be built under `Tag version`, leave target branch `master`

- Leave the `This is a pre-relese` unchecked and click on `Publish release`

- After approx. 10-20sec, the GitHub action will update the name/description of the release. A link to the running action will be added.

- The build takes about an hour and 15-20mins.

- After the build completes, the generated `QT` distribution will be uploaded to the release assets. The name/description will updated
  with the build status. In case of success the pre-release flag will be cleaned.

### Initiating a rebuild

- Locate the release in [Releases](../../releases) and click `Edit`.

- If the `This is a pre-relese` is checked, uncheck it, click on `Update release` and re-start editing.

- Check the `This is a pre-relese` and click on `Update release`.
